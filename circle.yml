machine:
  node:
    version: 5.1.0
    
dependencies:
  override:
    - npm install
    - npm install -g react-native-cli
    - sudo pip install awscli

test:
  override:
    - npm test
    - mkdir ios.bundle
    - react-native bundle --minify --dev false --entry-file index.ios.js --platform ios --assets-dest ios.bundle --bundle-output ios.bundle/main.jsbundle
    - zip -r ios.bundle.zip ios.bundle
    - npm run sign ios.bundle.zip
    - zip main.zip ios.bundle.zip  signature.txt

deployment:
  production:
    branch:  /.*/
    commands:
      - aws s3 cp main.zip s3://rn-chat/ios_$CIRCLE_BRANCH.zip --acl public-read